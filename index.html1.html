<!DOCTYPE html>
<html lang="bn" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ইউটিউব ট্যাগ ও এসইও টুল</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* কালার এবং থিম ভেরিয়েবল */
        :root {
            --primary: #ff0000; /* YouTube Red */
            --primary-dark: #cc0000;
            --gemini: #00b894; /* Teal for Gemini button */
            --gemini-dark: #00967d;
            --bg-body: #f4f7f6;
            --bg-card: #ffffff;
            --text-main: #2d3436;
            --text-sub: #636e72;
            --border: #dfe6e9;
            --chip-bg: #f1f2f6;
            --chip-hover: #e1e2e6;
            --shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        /* ডার্ক মোড */
        [data-theme="dark"] {
            --bg-body: #1e1e2e;
            --bg-card: #2d2d44;
            --text-main: #ffffff;
            --text-sub: #a0a0a0;
            --border: #404055;
            --chip-bg: #363654;
            --chip-hover: #45456b;
            --shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        * { box-sizing: border-box; transition: background 0.3s, color 0.3s, border-color 0.3s; }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* মেইন কার্ড স্টাইল */
        .app-container {
            background-color: var(--bg-card);
            width: 100%;
            max-width: 800px;
            border-radius: 16px;
            box-shadow: var(--shadow);
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .search-section, .llm-results-section {
            padding: 30px;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        /* ইনপুট ফিল্ড */
        input[type="text"] {
            flex: 1;
            padding: 15px;
            border: 2px solid var(--border);
            border-radius: 8px;
            background: var(--bg-body);
            color: var(--text-main);
            font-size: 16px;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 1px var(--primary);
        }

        /* বাটন স্টাইল */
        .btn-primary {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0 25px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.3s, transform 0.1s;
        }
        .btn-primary:hover:not(:disabled) { 
            background: var(--primary-dark); 
            transform: translateY(-1px);
        }
        .btn-primary:disabled {
            background: var(--text-sub);
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .btn-gemini {
            background: var(--gemini) !important;
        }
        .btn-gemini:hover:not(:disabled) {
            background: var(--gemini-dark) !important;
        }

        .options-bar {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        /* ট্যাগ ক্লাউড এবং চিপস */
        .tag-cloud {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            min-height: 100px;
        }

        .chip {
            background: var(--chip-bg);
            padding: 8px 14px;
            border-radius: 50px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            border: 1px solid transparent;
            transition: all 0.2s;
        }

        .chip:hover {
            background: var(--chip-hover);
            border-color: var(--primary);
        }

        .chip i {
            font-size: 12px;
            opacity: 0.5;
            transition: opacity 0.2s;
        }
        .chip i:hover { opacity: 1; color: var(--primary); }

        /* লোডার */
        .loader {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: var(--text-sub);
        }
        .spinner {
            width: 30px;
            height: 30px;
            border: 3px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s infinite linear;
            margin-bottom: 10px;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        
        /* জেমিনি রেজাল্ট স্টাইল */
        .llm-content h4 {
            color: var(--primary);
            margin-top: 20px;
            margin-bottom: 5px;
            border-bottom: 1px dashed var(--border);
            padding-bottom: 5px;
            font-size: 1.25rem;
            font-weight: 700;
        }

        .llm-content ul {
            list-style: none;
            padding-left: 0;
        }

        .llm-content ul li {
            background: var(--chip-bg);
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            font-size: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid var(--gemini);
        }
        .llm-content ul li .copy-llm-btn {
            background: var(--gemini);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .llm-content ul li .copy-llm-btn:hover {
             background: var(--gemini-dark);
        }
        
        .llm-content pre {
            background: var(--bg-body);
            padding: 15px;
            border-radius: 8px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 14px;
            border: 1px solid var(--border);
            position: relative;
        }
        
        .limit-alert { color: #e74c3c; font-weight: bold; }

        /* রেসপন্সিভ */
        @media(max-width: 600px) {
            .search-section, .llm-results-section, .results-area, .footer-stats {
                padding: 20px;
            }
            .input-group { flex-direction: column; }
            .btn-primary { width: 100%; padding: 12px; }
            .tools-bar { flex-direction: column; align-items: stretch; }
            .footer-stats { flex-direction: column; gap: 10px; text-align: center; }
            .options-bar { flex-direction: column; align-items: flex-start; }
            #geminiButton { margin-left: 0 !important; width: 100%; }
        }
    </style>
</head>
<body>
    <!-- লোগো এবং থিম টগল -->
    <div class="flex justify-between w-full max-w-4xl mb-6">
        <div class="text-3xl font-bold flex items-center gap-2">
            <i class="fab fa-youtube text-[--primary]"></i> <span class="dark:text-white">SEO <span class="text-[--primary]">Master</span></span>
        </div>
        <button onclick="toggleTheme()" class="theme-toggle-button">
            <i class="fas fa-moon dark:hidden text-gray-700"></i>
            <i class="fas fa-sun hidden dark:inline-block text-yellow-400"></i>
        </button>
    </div>

    <div class="app-container max-w-4xl">
        
        <!-- সার্চ সেকশন -->
        <div class="search-section border-b border-[--border]">
            <h2 class="text-2xl font-bold mb-4 dark:text-white">ট্যাগ এবং SEO আইডিয়া খুঁজুন</h2>
            <div class="input-group">
                <input type="text" id="keyword" placeholder="ভিডিওর টপিক লিখুন (যেমন: Aloo Posto Recipe)..." onkeypress="handleEnter(event)">
                <button class="btn-primary" onclick="startSearch()">
                    <i class="fas fa-search"></i> ট্যাগ খুঁজুন
                </button>
            </div>
            
            <div class="options-bar">
                <label class="checkbox-wrapper flex items-center text-sm dark:text-gray-300">
                    <input type="checkbox" id="deepSearch" class="mr-2"> 
                    <i class="fas fa-layer-group text-[--primary] mr-1"></i> ডিপ সার্চ (Deep Search)
                </label>
                <!-- জেমিনি বাটন -->
                <button class="btn-primary btn-gemini" onclick="generateSEOContent()" id="geminiButton" disabled style="margin-left: auto;">
                    <i class="fas fa-wand-magic-sparkles"></i> AI SEO কন্টেন্ট তৈরি করুন
                </button>
            </div>
        </div>

        <!-- AI রেজাল্ট সেকশন (টাইটেল, ডেসক্রিপশন) -->
        <div class="llm-results-section" id="llmResults" style="display: none;">
            <div class="loader" id="llmLoader">
                <div class="spinner"></div>
                <span id="llmLoadingText">জেমিনি আপনার জন্য সেরা টাইটেল ও ডেসক্রিপশন তৈরি করছে...</span>
            </div>
            <div id="llmContent" class="llm-content">
                <!-- LLM generated content goes here -->
            </div>
        </div>
        
        <!-- ট্যাগ টুলস বার -->
        <div class="tools-bar flex justify-between items-center p-4 border-y border-[--border] bg-gray-50 dark:bg-gray-800" id="toolsBar" style="opacity: 0.5; pointer-events: none;">
            <div class="flex items-center space-x-4">
                <div class="flex space-x-1 p-1 rounded-lg bg-gray-200 dark:bg-gray-700">
                    <button class="px-3 py-1 text-sm font-medium rounded-md hover:bg-white dark:hover:bg-gray-600" onclick="switchMode('tag')" id="btnTagMode">Tags</button>
                    <button class="px-3 py-1 text-sm font-medium rounded-md hover:bg-white dark:hover:bg-gray-600" onclick="switchMode('hashtag')" id="btnHashtagMode">#Hashtags</button>
                </div>
                <span id="totalTags" class="text-sm font-medium dark:text-gray-300">0 টি ট্যাগ</span>
            </div>
            
            <div class="action-buttons flex space-x-2">
                <button class="p-2 text-gray-600 hover:text-[--primary] dark:text-gray-400 dark:hover:text-white transition duration-150" title="সর্ট করুন" onclick="sortTags()">
                    <i class="fas fa-sort-alpha-down"></i>
                </button>
                <button class="p-2 text-gray-600 hover:text-green-500 dark:text-gray-400 dark:hover:text-green-400 transition duration-150" title="এক্সপোর্ট CSV" onclick="exportCSV()">
                    <i class="fas fa-file-csv"></i>
                </button>
                <button class="p-2 text-gray-600 hover:text-blue-500 dark:text-gray-400 dark:hover:text-blue-400 transition duration-150" title="সব কপি করুন" onclick="copyAll()">
                    <i class="fas fa-copy"></i>
                </button>
                <button class="p-2 text-gray-600 hover:text-red-500 dark:text-gray-400 dark:hover:text-red-500 transition duration-150" title="সব ডিলিট করুন" onclick="clearAll()">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>

        <!-- লোডার এবং ট্যাগ ক্লাউড এরিয়া -->
        <div class="results-area p-6">
            <div class="loader" id="loader">
                <div class="spinner"></div>
                <span id="loadingText" class="dark:text-gray-300">কিওয়ার্ড বিশ্লেষণ করা হচ্ছে...</span>
            </div>
            
            <div id="welcomeState" class="text-center text-gray-500 dark:text-gray-400 mt-10">
                <i class="fab fa-youtube text-6xl mb-4 opacity-30"></i>
                <p class="text-lg">ভিডিওর টপিক লিখে ট্যাগ জেনারেশন শুরু করুন।</p>
            </div>
            <div class="tag-cloud" id="tagContainer"></div>
        </div>

        <!-- ফুটার (ক্যারেক্টার কাউন্ট) -->
        <div class="footer-stats p-4 border-t border-[--border] bg-gray-50 dark:bg-gray-800 flex justify-end">
            <span id="charCount" class="text-sm dark:text-gray-400">0 / 500 ক্যারেক্টার</span>
        </div>

    </div>

    <script>
        // --- গ্লোবাল স্টেট ম্যানেজমেন্ট ---
        let tags = [];
        let isHashtagMode = false;
        
        // --- জেমিনি API কনফিগারেশন ---
        const API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=";
        const API_KEY = ""; // Canvas will provide this dynamically
        const LLM_MODEL = "gemini-2.5-flash-preview-09-2025";
        
        // --- থিম টগল ফাংশন ---
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
        }
        
        // --- কোর ফাংশন: ইউটিউব সাজেস্ট ট্যাগ ফেচ করা (Exponential Backoff সহ) ---
        async function fetchSuggestions(query) {
            // Public proxy is used for fetching cross-origin data
            const proxy = 'https://api.allorigins.win/raw?url=';
            // YouTube Suggest API endpoint
            const url = `https://suggestqueries.google.com/complete/search?client=firefox&ds=yt&q=${encodeURIComponent(query)}`;
            const fullUrl = proxy + encodeURIComponent(url);

            const MAX_RETRIES = 3;
            let delay = 1000; // 1 second start delay for retries

            for (let i = 0; i < MAX_RETRIES; i++) {
                try {
                    const res = await fetch(fullUrl);

                    if (!res.ok) {
                        if (i < MAX_RETRIES - 1) {
                            console.warn(`Retry attempt ${i + 1}: Received bad HTTP status ${res.status}. Retrying in ${delay / 1000}s...`);
                            await new Promise(resolve => setTimeout(resolve, delay));
                            delay *= 2; // Exponential backoff
                            continue;
                        }
                        throw new Error(`Failed to fetch tags: HTTP Status ${res.status}`);
                    }

                    // Successful fetch, parse JSON
                    const data = await res.json();
                    return data[1] || [];

                } catch (e) {
                    // Catches network errors (Failed to fetch) or JSON parsing errors
                    if (i < MAX_RETRIES - 1) {
                        console.warn(`Retry attempt ${i + 1}: Failed to fetch/parse. Retrying in ${delay / 1000}s...`);
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2; // Exponential backoff
                    } else {
                        console.error("API Error (YouTube Suggest) - Final attempt failed:", e.message);
                        return []; 
                    }
                }
            }
            return []; // Fallback
        }

        // --- কোর ফাংশন: জেমিনি এপিআই কল করে SEO কনটেন্ট জেনারেট করা ---
        async function generateSEOContent() {
            const keyword = document.getElementById('keyword').value.trim();
            const geminiButton = document.getElementById('geminiButton');
            const llmLoader = document.getElementById('llmLoader');
            const llmContent = document.getElementById('llmContent');
            const llmResults = document.getElementById('llmResults');

            if (tags.length === 0 || !keyword) {
                // Custom alert UI is needed since alert() is forbidden
                alert("দয়া করে প্রথমে 'ট্যাগ খুঁজুন' বাটন ক্লিক করে ট্যাগ জেনারেট করুন!");
                return;
            }

            // UI স্টেট: লোডিং শুরু
            geminiButton.disabled = true;
            llmResults.style.display = 'block';
            llmContent.innerHTML = '';
            llmLoader.style.display = 'flex';
            window.scrollTo({ top: llmResults.offsetTop - 20, behavior: 'smooth' });


            const systemPrompt = "Act as a professional YouTube SEO specialist. Your goal is to generate highly engaging and optimized content in Bangla based on the provided main keyword and related tags. Provide the output in the specified JSON format.";
            const userQuery = `Main Keyword: ${keyword}. Generated Tags: ${tags.join(', ')}. Generate 3 creative titles, a detailed video description draft (approx 200 words), and 3 distinct next video topic ideas based on this information. The description should be ready to copy and paste, and must include a welcome, a summary of video content, and a call to action.`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            "titles": {
                                "type": "ARRAY",
                                "description": "3 creative and clickable video titles in Bangla."
                            },
                            "description_draft": {
                                "type": "STRING",
                                "description": "An SEO-friendly video description draft (approx 200 words) in Bangla."
                            },
                            "next_video_ideas": {
                                "type": "ARRAY",
                                "description": "3 related, but distinct video topic ideas for a follow-up series in Bangla."
                            }
                        }
                    }
                }
            };

            try {
                const response = await fetch(API_URL + API_KEY, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                const result = await response.json();
                
                const jsonText = result.candidates?.[0]?.content?.parts?.[0]?.text;
                // Check if text is present and attempt to parse
                if (jsonText) {
                    const parsedJson = JSON.parse(jsonText);
                    renderLLMContent(parsedJson);
                } else {
                    throw new Error("Received empty or malformed response from AI.");
                }

            } catch (error) {
                console.error("Gemini API Error:", error);
                llmContent.innerHTML = `<p class="text-red-500 font-medium mt-4">জেমিনি কনটেন্ট জেনারেট করতে পারেনি। অনুগ্রহ করে আবার চেষ্টা করুন। (${error.message})</p>`;
            } finally {
                llmLoader.style.display = 'none';
                geminiButton.disabled = false;
            }
        }
        
        // --- LLM রেজাল্ট ডিসপ্লে করা ---
        function renderLLMContent(data) {
            const llmContent = document.getElementById('llmContent');
            let html = '';

            // ১. টাইটেল সাজেশন
            if (data.titles && data.titles.length > 0) {
                html += '<h4><i class="fas fa-heading mr-2"></i> সেরা টাইটেল আইডিয়া</h4>';
                html += '<ul class="mt-2">';
                data.titles.forEach(title => {
                    const escapedTitle = title.replace(/'/g, "\\'").replace(/"/g, '\\"');
                    html += `<li><span>${title}</span> <button class="copy-llm-btn" onclick="copyTextToClipboard('${escapedTitle}', this)"><i class="fas fa-copy"></i> কপি</button></li>`;
                });
                html += '</ul>';
            }

            // ২. ডেসক্রিপশন ড্রাফট
            if (data.description_draft) {
                html += '<h4><i class="fas fa-file-lines mr-2"></i> ডেসক্রিপশন ড্রাফট</h4>';
                html += `<pre id="descriptionDraft" class="mt-2">${data.description_draft}</pre>`;
                html += `<button class="btn-primary btn-gemini text-sm mt-3" onclick="copyTextToClipboard(document.getElementById('descriptionDraft').innerText, this)">
                            <i class="fas fa-copy"></i> ডেসক্রিপশন কপি করুন
                         </button>`;
            }

            // ৩. পরবর্তী ভিডিও আইডিয়া
            if (data.next_video_ideas && data.next_video_ideas.length > 0) {
                html += '<h4><i class="fas fa-video mr-2"></i> পরবর্তী ভিডিওর আইডিয়া</h4>';
                html += '<ul class="mt-2">';
                data.next_video_ideas.forEach(idea => {
                    const escapedIdea = idea.replace(/'/g, "\\'").replace(/"/g, '\\"');
                    html += `<li><span>${idea}</span> <button class="copy-llm-btn" onclick="copyTextToClipboard('${escapedIdea}', this)"><i class="fas fa-copy"></i> কপি</button></li>`;
                });
                html += '</ul>';
            }

            llmContent.innerHTML = html;
        }

        // --- মেইন সার্চ ফাংশন ---
        async function startSearch() {
            const keyword = document.getElementById('keyword').value.trim();
            const isDeep = document.getElementById('deepSearch').checked;
            const geminiButton = document.getElementById('geminiButton');
            
            if (!keyword) return alert("দয়া করে কিওয়ার্ড লিখুন!");

            // UI আপডেট
            setLoading(true);
            geminiButton.disabled = true; // ট্যাগ সার্চ চলাকালীন AI বাটন ডিসেবল
            document.getElementById('welcomeState').style.display = 'none';
            document.getElementById('toolsBar').style.opacity = '1';
            document.getElementById('toolsBar').style.pointerEvents = 'auto';
            tags = []; // রিসেট

            try {
                // লেভেল ১ সার্চ
                updateLoaderText("প্রাথমিক ট্যাগ খোঁজা হচ্ছে...");
                let initialTags = await fetchSuggestions(keyword);

                if (initialTags.length === 0) {
                    // যদি কোনো ট্যাগ না পাওয়া যায়, শুধু মূল কিওয়ার্ড যোগ করা হবে
                    updateLoaderText("কোনো প্রাথমিক ট্যাগ পাওয়া যায়নি, শুধুমাত্র মূল কিওয়ার্ড যোগ করা হচ্ছে...");
                    tags = [keyword];
                } else {
                    tags = [...initialTags];
                }

                // লেভেল ২ (ডিপ সার্চ)
                if (isDeep) {
                    updateLoaderText("ডিপ সার্চ চলছে (গভীর বিশ্লেষণ)...");
                    // প্রথম ৫টি রেজাল্ট নিয়ে আবার সার্চ করা হবে
                    const top5 = initialTags.slice(0, 5);
                    
                    const promises = top5.map(term => fetchSuggestions(term));
                    const deepResults = await Promise.all(promises);
                    
                    deepResults.forEach(subTags => {
                        tags = [...tags, ...subTags];
                    });
                }

                // ইউনিক করা (Duplicate Remove)
                tags = [...new Set(tags)];
                
                renderTags();
                // যদি ট্যাগ থাকে, তবে জেমিনি বাটন এনেবল করা হবে
                if (tags.length > 0) {
                    geminiButton.disabled = false; 
                }

            } catch (error) {
                // UI তে ত্রুটির বার্তা দেখানো
                document.getElementById('tagContainer').innerHTML = `<p class="text-red-500 text-center mt-4">ট্যাগ খোঁজার সময় সমস্যা হয়েছে। প্রক্সি বা নেটওয়ার্ক চেক করুন।</p>`;
            } finally {
                setLoading(false);
            }
        }

        // --- ট্যাগ রেন্ডার (ডিসপ্লে) ---
        function renderTags() {
            const container = document.getElementById('tagContainer');
            container.innerHTML = '';
            
            if (tags.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center mt-4 w-full">কোনো ট্যাগ নেই। নতুন করে সার্চ করুন।</p>';
                updateStats();
                return;
            }

            tags.forEach((tag, index) => {
                // হ্যাশট্যাগ মোড চেক: স্পেস সরিয়ে '#' যোগ করা
                let displayText = isHashtagMode ? '#' + tag.replace(/\s+/g, '') : tag;
                
                const div = document.createElement('div');
                div.className = 'chip';
                div.innerHTML = `
                    <span>${displayText}</span>
                    <i class="fas fa-times" onclick="removeTag(${index})"></i>
                `;
                container.appendChild(div);
            });
            
            // ট্যাগ মোড বাটন হাইলাইট করা
            const tagBtn = document.getElementById('btnTagMode');
            const hashtagBtn = document.getElementById('btnHashtagMode');
            tagBtn.classList.toggle('bg-white', !isHashtagMode);
            tagBtn.classList.toggle('dark:bg-gray-600', !isHashtagMode);
            hashtagBtn.classList.toggle('bg-white', isHashtagMode);
            hashtagBtn.classList.toggle('dark:bg-gray-600', isHashtagMode);

            updateStats();
        }

        // --- ট্যাগ মোড পরিবর্তন ---
        function switchMode(mode) {
            isHashtagMode = (mode === 'hashtag');
            renderTags();
        }

        // --- ট্যাগ রিমুভ করা ---
        function removeTag(index) {
            tags.splice(index, 1);
            renderTags();
        }

        // --- সব ডিলিট করা ---
        function clearAll() {
            if(confirm("সব ট্যাগ ও AI কনটেন্ট মুছে ফেলতে চান?")) {
                tags = [];
                renderTags();
                document.getElementById('llmResults').style.display = 'none';
                document.getElementById('geminiButton').disabled = true;
                // ট্যাগ ক্লাউড এরিয়া পরিষ্কার করা
                document.getElementById('tagContainer').innerHTML = '';
                document.getElementById('welcomeState').style.display = 'block';
                document.getElementById('toolsBar').style.opacity = '0.5';
                document.getElementById('toolsBar').style.pointerEvents = 'none';
                updateStats();
            }
        }

        // --- ট্যাগ সর্ট করা ---
        function sortTags() {
            tags.sort();
            renderTags();
        }

        // --- স্ট্যাটাস আপডেট করা (ক্যারেক্টার কাউন্ট) ---
        function updateStats() {
            document.getElementById('totalTags').innerText = `${tags.length} টি ট্যাগ`;
            
            let text = "";
            if (isHashtagMode) {
                // হ্যাশট্যাগ মোডে স্পেস দিয়ে জয়েন
                text = tags.map(t => '#' + t.replace(/\s+/g, '')).join(' ');
            } else {
                // ট্যাগ মোডে কমা দিয়ে জয়েন
                text = tags.join(', ');
            }
            
            const count = tags.length > 0 ? text.length : 0;
            const charSpan = document.getElementById('charCount');
            
            charSpan.innerText = `${count} / 500 ক্যারেক্টার`;
            
            // ইউটিউবের ট্যাগ লিমিট ৫০০ ক্যারেক্টার
            if (count > 500) {
                charSpan.classList.add('limit-alert');
            } else {
                charSpan.classList.remove('limit-alert');
            }
        }

        // --- সব ট্যাগ কপি করা ---
        function copyAll() {
            if (tags.length === 0) return;
            
            let textToCopy = "";
            if (isHashtagMode) {
                textToCopy = tags.map(t => '#' + t.replace(/\s+/g, '')).join(' ');
            } else {
                textToCopy = tags.join(', ');
            }

            const copyButton = document.querySelector('.action-buttons button:nth-child(3)');
            copyTextToClipboard(textToCopy, copyButton);
        }
        
        // --- ক্লিপবোর্ডে কপি করার ফাংশন ---
        function copyTextToClipboard(text, element) {
             navigator.clipboard.writeText(text).then(() => {
                const originalContent = element.innerHTML;
                element.innerHTML = '<i class="fas fa-check"></i> কপিড!';
                setTimeout(() => element.innerHTML = originalContent, 2000);
            }).catch(err => {
                // Fallback method
                const textArea = document.createElement("textarea");
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand("copy");
                document.body.removeChild(textArea);
                
                const originalContent = element.innerHTML;
                element.innerHTML = '<i class="fas fa-check"></i> কপিড!';
                setTimeout(() => element.innerHTML = originalContent, 2000);
            });
        }

        // --- CSV এক্সপোর্ট করা ---
        function exportCSV() {
            if (tags.length === 0) return alert("এক্সপোর্ট করার মতো কিছু নেই!");

            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Tag,Length\n"; // Header
            
            tags.forEach(tag => {
                csvContent += `"${tag.replace(/"/g, '""')}","${tag.length}"\n`; // কোটেশন ও লেন্থ সহ
            });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "youtube_seo_tags.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // --- লোডার টগল করা ---
        function setLoading(state) {
            document.getElementById('loader').style.display = state ? 'flex' : 'none';
            document.getElementById('tagContainer').style.display = state ? 'none' : 'flex';
        }

        // --- লোডারের লেখা আপডেট করা ---
        function updateLoaderText(text) {
            document.getElementById('loadingText').innerText = text;
        }

        // --- এন্টার কি প্রেস হ্যান্ডেল করা ---
        function handleEnter(e) {
            if (e.key === 'Enter') startSearch();
        }
        
        // --- ইনিশিয়াল লোড ---
        document.addEventListener('DOMContentLoaded', () => {
            switchMode('tag'); // ডিফল্ট মোড সেট
        });
    </script>
</body>
</html>